<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Badge 5 - Word Frequency, Summarising and Visualising your data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/clipboard/clipboard.min.js"></script>
<script src="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/quarto-html/quarto.js"></script>
<script src="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/quarto-html/popper.min.js"></script>
<script src="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/quarto-html/anchor.min.js"></script>
<link href="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/quarto-html/quarto-syntax-highlighting-3a01e2046221230fdceeea94b1ec5d67.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="nlp_badge_05_FreqVisualSummary_v1.3_files/libs/bootstrap/bootstrap-34745567add538a638dde46bc8a747e1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Badge 5 - Word Frequency, Summarising and Visualising your data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="word-frequency-summarising-and-visualising-your-data" class="level1">
<h1>Word Frequency, Summarising and Visualising your data</h1>
<p>Let’s load some libraries we will need. Since there will be quite a few, We’ll introduce you to a really lovely package called <code>Pacman</code>. It will ‘munch through’ a list of packages and make sure they are installed, and updates and then load them.</p>
<p>So basically, less of that <code>install.packages(package_name)</code> and <code>library(package_name)</code> stuff.</p>
<p>WHEN YOU RUN THE CODE BELOW YOU MIGHT BE ASKED IF YOU’D LIKE TO RELOAD RSTUDIO: <strong>ANSWER ‘NO’</strong></p>
<section id="first-lets-load-some-data" class="level2">
<h2 class="anchored" data-anchor-id="first-lets-load-some-data">First: Let’s load some data</h2>
<p>We will convert our data to a tibble format to work with this in <code>tidytext</code> this converts the data to a tibble format and separates each row of the dataframe word by word</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the csv to a datframe</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span>  <span class="st">'./data/CORONA_TWEETS.csv'</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>Corona_NLP_DF <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting into the tibble dataframe</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>mydata_TB <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Corona_NLP_DF) </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>mydata_dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(Corona_NLP_DF)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>mydata_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      doc_id
       &lt;int&gt;
   1:      1
   2:      2
   3:      3
   4:      4
   5:      5
  ---       
3794:   3794
3795:   3795
3796:   3796
3797:   3797
3798:   3798
                                                                                                                                                                                                                                                                                                                                               text
                                                                                                                                                                                                                                                                                                                                             &lt;char&gt;
   1:                                                                                                          TRENDING: New Yorkers encounter empty supermarket shelves (pictured, Wegmans in Brooklyn), sold-out online grocers (FoodKick, MaxDelivery) as #coronavirus-fearing shoppers stock up https://t.co/Gr76pcrLWh https://t.co/ivMKMsqdT1
   2:                                                                                                                                             When I couldn't find hand sanitizer at Fred Meyer, I turned to #Amazon. But $114.97 for a 2 pack of Purell??!!Check out how  #coronavirus concerns are driving up prices. https://t.co/ygbipBflMY
   3:                                                                                                                                                                                                                                                                     Find out how you can protect yourself and loved ones from #coronavirus. ?
   4: #Panic buying hits #NewYork City as anxious shoppers stock up on food&amp;amp;medical supplies after #healthcare worker in her 30s becomes #BigApple 1st confirmed #coronavirus patient OR a #Bloomberg staged event?\n\n\n\n\n\nhttps://t.co/IASiReGPC4\n\n\n\n\n\n#QAnon #QAnon2018 #QAnon2020 \n\n\n#Election2020 #CDC https://t.co/29isZOewxu
   5:                                                                                  #toiletpaper #dunnypaper #coronavirus #coronavirusaustralia #CoronaVirusUpdate #Covid_19 #9News  #Corvid19 #7NewsMelb #dunnypapergate #Costco    One week everyone buying baby milk powder the next everyone buying up toilet paper. https://t.co/ScZryVvsIh
  ---                                                                                                                                                                                                                                                                                                                                              
3794:                                                                                                                                                                                                               Meanwhile In A Supermarket in Israel -- People dance and sing together to stay positive. ? #CoronaVirus https://t.co/VLLqGI3R16
3795:                                                                                                                         Did you panic buy a lot of non-perishable items? ECHO needs food donations. It is also looking for volunteers to pack boxes. Volunteers will be screened to be sure they don't have COVID-19. https://t.co/TST4Vjhbu4
3796:                                                                                                                                                     Asst Prof of Economics @cconces was on @NBCPhiladelphia talking about her recent research on coronavirus' impact on the economy. Watch it here (starting at :33): https://t.co/8tfYNoro5l
3797:                                                                                                                                                                Gov need to do somethings instead of biar je rakyat assume 'lockdown' ke or even worst. Harini semua supermarket crowded like hell. Lagi mudah virus tu tersebar ?? #COVID2019
3798:                                                                                I and @ForestandPaper members are committed to the safety of our employees and our end-users. We are monitoring COVID-19. Rest assured that tissue manufacturers are continuing to produce and ship products.  https://t.co/qF6hclCAEq https://t.co/xyvbNsFeXA
      ScreenName Location    TweetAt          Sentiment
           &lt;int&gt;   &lt;char&gt;     &lt;char&gt;             &lt;char&gt;
   1:      44953       UK 02/03/2020 Extremely Negative
   2:      44954       UK 02/03/2020           Positive
   3:      44955       UK 02/03/2020 Extremely Positive
   4:      44956       UK 02/03/2020           Negative
   5:      44957       UK 03/03/2020            Neutral
  ---                                                  
3794:      48746       UK 16/03/2020           Positive
3795:      48747       UK 16/03/2020           Negative
3796:      48748       UK 16/03/2020            Neutral
3797:      48749       UK 16/03/2020 Extremely Negative
3798:      48750       UK 16/03/2020 Extremely Positive</code></pre>
</div>
</div>
</section>
<section id="term-frequency" class="level2">
<h2 class="anchored" data-anchor-id="term-frequency">Term Frequency</h2>
<p>We are going to look at the frequency of words in our Corona corpus.</p>
<p>What are the most commonly used words in our data?<br>
We use the <code>tidytext</code> package to tokenise to words (unnest _tokens function you saw in the previous badge) and we count the tokens.</p>
<p>This gives us a tibble table with the word in one column and the count in a column labelled <code>'n'</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mydata_word_counts <span class="ot">&lt;-</span> mydata_TB <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, <span class="at">input=</span> text) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#see the output table</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>mydata_word_counts </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13,966 × 2
   word            n
   &lt;chr&gt;       &lt;int&gt;
 1 the          4271
 2 to           3746
 3 and          2461
 4 of           2071
 5 in           1853
 6 t.co         1824
 7 https        1823
 8 a            1820
 9 covid_19     1541
10 coronavirus  1525
# ℹ 13,956 more rows</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Or, using data.table…</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dt_word_counts <span class="ot">&lt;-</span> mydata_dt[, <span class="fu">unnest_tokens</span>(.SD, <span class="at">output =</span> word, <span class="at">input =</span> text), .SDcols <span class="ot">=</span> <span class="st">"text"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>          ][, .N, by <span class="ot">=</span> word</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>          ][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>dt_word_counts </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 word     N
               &lt;char&gt; &lt;int&gt;
    1:            the  4271
    2:             to  3746
    3:            and  2461
    4:             of  2071
    5:             in  1853
   ---                     
13962:             tu     1
13963:       tersebar     1
13964: forestandpaper     1
13965:     qf6hclcaeq     1
13966:     xyvbnsfexa     1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#same again but this time using the group_by to group by Location column value</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mydata_words_byLocation <span class="ot">&lt;-</span> mydata_TB <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Location) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, <span class="at">input=</span> text) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#see the output table</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>mydata_words_byLocation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15,653 × 3
# Groups:   Location [2]
   Location word            n
   &lt;chr&gt;    &lt;chr&gt;       &lt;int&gt;
 1 UK       the          4006
 2 UK       to           3517
 3 UK       and          2336
 4 UK       of           1949
 5 UK       in           1744
 6 UK       t.co         1724
 7 UK       https        1723
 8 UK       a            1704
 9 UK       covid_19     1456
10 UK       coronavirus  1422
# ℹ 15,643 more rows</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>or, using data.table</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dt_words_location <span class="ot">&lt;-</span> mydata_dt[, <span class="fu">unnest_tokens</span>(.SD, <span class="at">output =</span> word, <span class="at">input =</span> text)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>          ][, .N, by <span class="ot">=</span> .(Location, word)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>          ][<span class="fu">order</span>(Location, <span class="sc">-</span>N)]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>dt_words_location</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Location       word     N
         &lt;char&gt;     &lt;char&gt; &lt;int&gt;
    1:       UK        the  4006
    2:       UK         to  3517
    3:       UK        and  2336
    4:       UK         of  1949
    5:       UK         in  1744
   ---                          
15649:      USA university     1
15650:      USA         40     1
15651:      USA  confirmed     1
15652:      USA      cases     1
15653:      USA        cor     1</code></pre>
</div>
</div>
</section>
<section id="putting-word-counts-into-graphs" class="level2">
<h2 class="anchored" data-anchor-id="putting-word-counts-into-graphs">Putting Word Counts into Graphs</h2>
<p>We can use ggplot to graph our word counts.</p>
<p>Here we filter to limit the words being shown otherwise the volume of words with low numbers would be overwhelming.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mydata_word_counts <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">reorder</span>(word, n)) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, word)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/graph_counts-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>data.table + lattice</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># barchart sorts by factor level, not data.table sorting</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># so, first, convert word to a factor and set levels based on .N</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>dt_word_counts[, word <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(word, <span class="at">levels =</span> word[<span class="fu">order</span>(N)])]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barchart</span>(word <span class="sc">~</span> N, dt_word_counts[N <span class="sc">&gt;</span> <span class="dv">350</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>and then</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graph the top 15 most common words in each Location</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mydata_TB <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Location) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Location =</span> <span class="fu">factor</span>(Location),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">text_order =</span> <span class="fu">nrow</span>(.)<span class="sc">:</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(word, text_order), n, <span class="at">fill =</span> Location)) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Location, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"NULL"</span>, <span class="at">y =</span> <span class="st">"Word Frequency by Location"</span>) <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Selecting by n</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/graph_counts1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>data.table + lattice</p>
</blockquote>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dt_top15_uk <span class="ot">&lt;-</span> dt_words_location[Location <span class="sc">==</span> <span class="st">"UK"</span>, <span class="fu">head</span>(.SD, <span class="dv">15</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                 ][, word <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(word, <span class="at">levels =</span> word[<span class="fu">order</span>(N)])]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>dt_top15_usa <span class="ot">&lt;-</span> dt_words_location[Location <span class="sc">==</span> <span class="st">"USA"</span>, <span class="fu">head</span>(.SD, <span class="dv">15</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                 ][, word <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(word, <span class="at">levels =</span> word[<span class="fu">order</span>(N)])]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barchart</span>(word <span class="sc">~</span> N, dt_top15_uk, <span class="at">main =</span> <span class="st">"UK"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">barchart</span>(word <span class="sc">~</span> N, dt_top15_usa, <span class="at">main =</span> <span class="st">"USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>nb: this slightly convoluted method is to allow for separate ordering of the two bar charts. Can merge into one without proper ordering as follows:</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barchart</span>(word <span class="sc">~</span> N <span class="sc">|</span> Location, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>         dt_words_location[, <span class="fu">head</span>(.SD, <span class="dv">15</span>), <span class="at">by =</span> Location],</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">scales =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">list</span>(<span class="at">relation =</span> <span class="st">"free"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here we see the most frequent words are words that likely hold no value for understanding of the text. What we called stop words in last weeks badge. (a, the, in , an)</p>
<p>We can use the built in options of <code>tidyverse</code> to remove the stop words. <code>anti_join</code> is the function and we give it an input of <code>stop_words</code>.</p>
<blockquote class="blockquote">
<p><code>stop_words</code> is a dataset from the <code>tidytext</code> package that contains a list of common stop words in English.</p>
</blockquote>
<p>Run the code and see the difference in the frequent words compared to the graph above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graph the top 15 most common words in each Location without stopwords</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>mydata_TB <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Location) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Location =</span> <span class="fu">factor</span>(Location),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">text_order =</span> <span class="fu">nrow</span>(.)<span class="sc">:</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(word, text_order), n, <span class="at">fill =</span> Location)) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Location, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"NULL"</span>, <span class="at">y =</span> <span class="st">"Word Frequency by Location"</span>) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(word)`
Selecting by n</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/graph_withstopremoved-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>data.table + lattice</p>
</blockquote>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dt_words_location_stop <span class="ot">&lt;-</span> dt_words_location[<span class="sc">!</span>word <span class="sc">%in%</span> stop_words<span class="sc">$</span>word]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dt_top15_stop_uk <span class="ot">&lt;-</span> dt_words_location_stop[Location <span class="sc">==</span> <span class="st">"UK"</span>, <span class="fu">head</span>(.SD, <span class="dv">15</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                                 ][, word <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(word, <span class="at">levels =</span> word[<span class="fu">order</span>(N)])]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>dt_top15_stop_usa <span class="ot">&lt;-</span> dt_words_location_stop[Location <span class="sc">==</span> <span class="st">"USA"</span>, <span class="fu">head</span>(.SD, <span class="dv">15</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                                 ][, word <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(word, <span class="at">levels =</span> word[<span class="fu">order</span>(N)])]</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">barchart</span>(word <span class="sc">~</span> N, dt_top15_stop_uk, <span class="at">main =</span> <span class="st">"UK"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">barchart</span>(word <span class="sc">~</span> N, dt_top15_stop_usa, <span class="at">main =</span> <span class="st">"USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>and the simpler (non-ordered) method…</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dt_words_location_stop <span class="ot">&lt;-</span> dt_words_location[<span class="sc">!</span>word <span class="sc">%in%</span> stop_words<span class="sc">$</span>word,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">head</span>(.SD, <span class="dv">15</span>), by <span class="ot">=</span> Location]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">barchart</span>(word <span class="sc">~</span> N <span class="sc">|</span> Location, dt_words_location_stop,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">scales =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">list</span>(<span class="at">relation =</span> <span class="st">"free"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>                       <span class="co">#y = list(relation = "free")))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="activity-using-your-own-excluded-words" class="level2">
<h2 class="anchored" data-anchor-id="activity-using-your-own-excluded-words">ACTIVITY: Using your own ‘excluded words’</h2>
<p>Can you create your own word list you want to remove? Hint: fight after you remove stopwords, use <code>filter()</code> to specify in what situation you’d like to filter words out. Use your own collection of words that you do not think of as meaningful in this example.</p>
<p>As your solution, copy the code above, and add an extra line after <code>anti_join(stop_words) %&gt;%</code>.</p>
<p><strong>But wait! What does filter() do again?</strong> To find our more about it, in console write <code>help(filter)</code> then select the <code>dplyr</code> packages and then select <code>filter</code> to see options. But also, below we left you two hints, if you have not used <code>filter()</code> before. (It’s OK if you did not).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your solution here</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>dt_words_location_stop2 <span class="ot">&lt;-</span> dt_words_location[<span class="sc">!</span>word <span class="sc">%in%</span> <span class="fu">c</span>(stop_words<span class="sc">$</span>word, <span class="st">"covid"</span>, <span class="st">"store"</span>, <span class="st">"panic"</span>, <span class="st">"grocery"</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">head</span>(.SD, <span class="dv">15</span>), by <span class="ot">=</span> Location]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barchart</span>(word <span class="sc">~</span> N <span class="sc">|</span> Location, dt_words_location_stop2,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">scales =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">list</span>(<span class="at">relation =</span> <span class="st">"free"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><a href="./hints/hint_5_1.Rmd">Hint 1 about the filter() - how does it work</a> <a href="./hints/hint_5_2.Rmd">Hint 2 about the filter() - how to use it with collections</a></p>
<p>Ok now you should be equipped to solve the task.</p>
<p><a href="./hints/hint_5_3.Rmd">A solution (but first have a try by yourself)</a></p>
</section>
<section id="for-completenes-another-way-to-remove-unwanted-words" class="level2">
<h2 class="anchored" data-anchor-id="for-completenes-another-way-to-remove-unwanted-words">For completenes: another way to remove unwanted words:</h2>
<p>You can also extend the usual set of <code>stopwords</code> which one always removes like “and”, “or”, “the”, etc. And add there words that are in your data (eg. ‘http’ in this dataset), so that it gets removed at the same time that the <code>stopwords</code> are removed. See ecample below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create custom stop word list</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>stop_words_expanded <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">word =</span> <span class="fu">c</span>(<span class="st">"https"</span>, <span class="st">"t.co"</span>), <span class="at">lexicon =</span> <span class="st">"custom"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(stop_words)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#above: create a dataframe with your own stopwords, and right-bind to it (add to it) to the usual stop_words. Then use that new stopwords variable. Notice use of Pipe!</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>mydata_TB <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words_expanded) <span class="sc">%&gt;%</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">30</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(word)`
Selecting by n</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 2
   word            n
   &lt;chr&gt;       &lt;int&gt;
 1 covid_19     1541
 2 coronavirus  1525
 3 food         1367
 4 store        1028
 5 grocery       823
 6 19            816
 7 covid         816
 8 stock         795
 9 people        792
10 amp           610
# ℹ 20 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mini-activity: out of curiousity, add a few more words to this exclusion list, to keep the first results even more relevant (eg. data is obviously about covid_19 so maybe covid words can be removed?) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tf-idf-a-product-of-term-frequency-and-inverse-document-frequency" class="level2">
<h2 class="anchored" data-anchor-id="tf-idf-a-product-of-term-frequency-and-inverse-document-frequency">TF-IDF (a product of ‘Term Frequency’ and ‘Inverse Document Frequency’)</h2>
<p>TF-IDF method helps to find important words for the content of each document by decreasing the weight of commonly used words and increasing the weight of words that are rarely used. It attempts to find words that are important in a text (common themes) but not too common (e.g.&nbsp;to, the, a)</p>
<p>To calculate <code>tf-idf</code> we first need to get the word or term frequencies (which we did above), the <code>total words</code> in the corpus and then we then use the <code>bind_tf_idf</code> function from <code>tidytext</code> which will calculate the TF_IDF weights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mydata_word_freq <span class="ot">&lt;-</span> mydata_TB <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> word,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">input =</span> text,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">to_lower =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip_punc =</span> <span class="cn">TRUE</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Location, word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(word)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>mydata_word_freq <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(word, Location, n) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,673 × 6
   Location word             n       tf   idf   tf_idf
   &lt;chr&gt;    &lt;chr&gt;        &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1 UK       roll            67 0.00108  0.693 0.000745
 2 USA      emergencyubi     4 0.000982 0.693 0.000681
 3 UK       banks           50 0.000802 0.693 0.000556
 4 UK       worried         46 0.000738 0.693 0.000512
 5 USA      liquidity        3 0.000736 0.693 0.000510
 6 USA      lng              3 0.000736 0.693 0.000510
 7 UK       selling         43 0.000690 0.693 0.000478
 8 UK       essentials      41 0.000658 0.693 0.000456
 9 UK       hard            41 0.000658 0.693 0.000456
10 UK       rice            39 0.000626 0.693 0.000434
# ℹ 14,663 more rows</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>using data.table</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>word_freq <span class="ot">&lt;-</span> mydata_dt[, <span class="fu">unnest_tokens</span>(.SD, <span class="at">output =</span> word, <span class="at">input =</span> text)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>          ][<span class="sc">!</span>word <span class="sc">%in%</span> stop_words<span class="sc">$</span>word</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>          ][, .(<span class="at">n =</span> .N), by <span class="ot">=</span> .(Location, word)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>          ][, <span class="fu">bind_tf_idf</span>(.SD, word, Location, n)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>          ][<span class="fu">order</span>(<span class="sc">-</span>tf_idf)]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>word_freq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Location         word     n           tf       idf       tf_idf
         &lt;char&gt;       &lt;char&gt; &lt;int&gt;        &lt;num&gt;     &lt;num&gt;        &lt;num&gt;
    1:       UK         roll    67 0.0010752170 0.6931472 0.0007452837
    2:      USA emergencyubi     4 0.0009818360 0.6931472 0.0006805569
    3:       UK        banks    50 0.0008024008 0.6931472 0.0005561818
    4:       UK      worried    46 0.0007382087 0.6931472 0.0005116873
    5:      USA          lng     3 0.0007363770 0.6931472 0.0005104177
   ---                                                                
14669:      USA      hopkins     1 0.0002454590 0.0000000 0.0000000000
14670:      USA   university     1 0.0002454590 0.0000000 0.0000000000
14671:      USA           40     1 0.0002454590 0.0000000 0.0000000000
14672:      USA    confirmed     1 0.0002454590 0.0000000 0.0000000000
14673:      USA          cor     1 0.0002454590 0.0000000 0.0000000000</code></pre>
</div>
</div>
</section>
<section id="wordclouds" class="level2">
<h2 class="anchored" data-anchor-id="wordclouds">WordClouds</h2>
<p>Let’s load the libraries we need:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the required libraries (this is a simpler version, but you can use the fancy one from above)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(wordcloud, wordcloud2, RColorBrewer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Creating a Word Cloud</strong></p>
<p>Word clouds are great quick visualisation tools. They present text data in a simple and format where the size of the words depends on their respective frequencies. They are a quick way to understand and capture the conversation or report on customer reviews (often see them used in online conferences where people share their thoughts on a form).</p>
<p>They can stimulate us to think on what and how we want to analyse the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#this counts the words in the text column removing stop words</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>cloud_words <span class="ot">&lt;-</span>  mydata_TB <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(text) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">%&gt;%</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(word)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This sorts (orders) the counts of the words</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>words <span class="ot">&lt;-</span> cloud_words <span class="sc">%&gt;%</span> <span class="fu">count</span>(word, <span class="at">sort=</span><span class="cn">TRUE</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13,346 × 2
   word            n
   &lt;chr&gt;       &lt;int&gt;
 1 t.co         1824
 2 https        1823
 3 covid_19     1541
 4 coronavirus  1525
 5 food         1367
 6 store        1028
 7 grocery       823
 8 19            816
 9 covid         816
10 stock         795
# ℹ 13,336 more rows</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>data.table</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cloud_words <span class="ot">&lt;-</span> mydata_dt[, <span class="fu">unnest_tokens</span>(.SD, <span class="at">output =</span> word, <span class="at">input =</span> text)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                 ][</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">!</span>word <span class="sc">%in%</span> stop_words<span class="sc">$</span>word</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                 ][</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                    , .(<span class="at">n =</span> .N), by <span class="ot">=</span> word</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                 ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have words, let’s feed them into the wordcloud:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># see note below abotu seeds. Run this a few times with this line, and a few more times with this line commented out. What changes?</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Now lets draw the word cloud</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">words =</span> cloud_words[, word],</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> cloud_words[, n],</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.freq =</span> <span class="dv">50</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.words =</span> <span class="dv">200</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">random.order =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">rot.per =</span> <span class="fl">0.35</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/wordcloud1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>What is a seed? (Simplified ‘Computer Science’ explanation)</strong>. When you generate a wordcloud, you leave a lot of things to random chance, like position of words. This means that each time you generate a wordcloud it will look a little different. But sometimes, for reproducibility, you want to stop randomness, and you can achieve that by giving the computer your own ‘seed of randomnes’. It is a very specific number, that will force the ‘random’ elements, to always be the same. For the curious: If you do not plant a concrete seed, the library will pick one for you (e.g.&nbsp;current date as a millisecond), so each time you generate a wordcloud it will be slightly different.</p>
<p>If you do not specify the seed consistency if you want to produce exactly the same word cloud next time you run this. Try to commend out the line with the seed above, and re-generate the wordcloud a few times - do you see them being different each time? In general Seeds are great when you are building and debugging, it means that you fully control what is going on in your graph.</p>
<p><strong>But how is wordcloud made?</strong></p>
<p>The <code>wordcloud</code> package uses base R plotting capabilities and calculates the width and the height of the word to create a bounding box of space occupied by the word. The algorithm then places words based on this definition of occupied space. The <code>wordcloud2</code> uses a method that defines which pixels are occupied by a word rather than the bounding box occupied by the whole word. This allows for more creativity.</p>
</section>
<section id="activity-wordcloud-of-bi-grams-common-two-word-combinations" class="level2">
<h2 class="anchored" data-anchor-id="activity-wordcloud-of-bi-grams-common-two-word-combinations">ACTIVITY: Wordcloud of bi-grams (common two word combinations)</h2>
<p>Can you repeat this for ngrams of 2, rather than just single words? Look through this and previous notebooks, to remind yourself how ngrams are created. Also can you change the shape of the word cloud or the colors. Use <code>help(wordcloud2)</code> in console to see you available options.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write your code here</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>cloud_bigram <span class="ot">&lt;-</span> mydata_dt[, <span class="fu">unnest_tokens</span>(.SD, <span class="at">output =</span> bigram, <span class="at">input =</span> text,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">token=</span><span class="st">"ngrams"</span>, <span class="at">n=</span><span class="dv">2</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                ][</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                    , .(<span class="at">n =</span> .N), by <span class="ot">=</span> bigram</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">words =</span> cloud_bigram[, bigram],</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> cloud_bigram[, n],</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.freq =</span> <span class="dv">50</span>,</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.words =</span> <span class="dv">200</span>,</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">random.order =</span> <span class="cn">FALSE</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">rot.per =</span> <span class="fl">0.35</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># what about removing stop words?</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># split into 'word1' and 'word2' and remove if either of these words are a 'stop word'</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>cloud_bigram_stop <span class="ot">&lt;-</span> cloud_bigram[</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                          , <span class="fu">c</span>(<span class="st">"word1"</span>, <span class="st">"word2"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(bigram, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                          ][</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">!</span>(word1 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word<span class="sc">|</span>word2 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                          ]</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">words =</span> cloud_bigram_stop[, bigram],</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> cloud_bigram_stop[, n],</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.freq =</span> <span class="dv">20</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.words =</span> <span class="dv">200</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">random.order =</span> <span class="cn">FALSE</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">rot.per =</span> <span class="fl">0.35</span>,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Only if you’ve already tried for 5+ minutes, you can see below for some hints. But please use the help function to see other options. It’s also worth googling on R wordclouds to see examples</p>
<p><a href="./hints/hint_5_4.Rmd">Answer</a></p>
</section>
<section id="word-co-occurance" class="level2">
<h2 class="anchored" data-anchor-id="word-co-occurance">Word Co-occurance</h2>
<p>Visualising the relationships between words as opposed to just frequencies can be helpful. One way to do this is using network graphs. A graph represents a combination of connected nodes where the nodes in this case are our words and the weight is how ‘much’ these words are connected. The graph is a visual representation of the word occurrence table we talked about on the slides</p>
<p>The weight is represented by a line on the graph (or edge) between two words and the darker or thicker the line the stronger the relationship.</p>
<p>The lines (edges) between the words can have direction also.</p>
<p>We are going to use <code>tidytext</code> and the <code>ggraph</code> package to visualise these connections</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'igraph'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:lubridate':

    %--%, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:purrr':

    compose, simplify</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    crossing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    as_data_frame, groups, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tibble':

    as_data_frame</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    decompose, spectrum</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:base':

    union</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we want to create bigrams but remove stop words.  First, we create bigrams</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>mydata_words_bigrams <span class="ot">&lt;-</span> mydata_TB <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> ngram,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">input =</span> text,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">token =</span> <span class="st">"ngrams"</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">2</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">#This uses the anti_join to look at each word in the bigram and remove if it contains a stop words</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>mydata_words_bigrams <span class="ot">&lt;-</span> mydata_words_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(ngram, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"first"</span>,<span class="st">"second"</span>),</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words,</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"first"</span> <span class="ot">=</span> <span class="st">"word"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"second"</span> <span class="ot">=</span> <span class="st">"word"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ngram, <span class="at">sort =</span> <span class="cn">TRUE</span>) </span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="co"># filter for only relatively common combinations</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>bigram_graph <span class="ot">&lt;-</span> mydata_words_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">graph_from_data_frame</span>()</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the word co-occurances: these are words happening immediately next to each other frequently:</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>bigram_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>IGRAPH 2631f9d DN-- 102 62 -- 
+ attr: name (v/c)
+ edges from 2631f9d (vertex names):
 [1] https t.co                  -&gt;1822 covid 19                    -&gt;771 
 [3] grocery store               -&gt;678  toilet paper                -&gt;314 
 [5] online shopping             -&gt;227  covid_19 https              -&gt;202 
 [7] panic buying                -&gt;183  coronavirus https           -&gt;141 
 [9] coronavirus covid_19        -&gt;91   covid_19 coronavirus        -&gt;89  
[11] retail store                -&gt;74   coronavirus covid19         -&gt;65  
[13] hand sanitizer              -&gt;63   coronaviruspandemic covid_19-&gt;59  
[15] local grocery               -&gt;59   covid_19 coronaviruspandemic-&gt;58  
+ ... omitted several edges</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>using data.table</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>bigrams <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(mydata_dt[, <span class="fu">unnest_tokens</span>(.SD, <span class="at">output =</span> bigram, <span class="at">input =</span> text,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">token=</span><span class="st">"ngrams"</span>, <span class="at">n=</span><span class="dv">2</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                ])</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>bigrams[</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>          , <span class="fu">c</span>(<span class="st">"word1"</span>, <span class="st">"word2"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(bigram, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        ][</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>          <span class="sc">!</span>(word1 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word<span class="sc">|</span>word2 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word), .(<span class="at">n =</span> .N), by <span class="ot">=</span> bigram</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        ][n <span class="sc">&gt;</span> <span class="dv">20</span>][<span class="fu">order</span>(<span class="sc">-</span>n)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          bigram     n
                          &lt;char&gt; &lt;int&gt;
 1:                   https t.co  1822
 2:                     covid 19   771
 3:                grocery store   678
 4:                 toilet paper   314
 5:              online shopping   227
 6:               covid_19 https   202
 7:                 panic buying   183
 8:            coronavirus https   141
 9:         coronavirus covid_19    91
10:         covid_19 coronavirus    89
11:                 retail store    74
12:          coronavirus covid19    65
13:               hand sanitizer    63
14: coronaviruspandemic covid_19    59
15:                local grocery    59
16: covid_19 coronaviruspandemic    58
17:          covid19 coronavirus    53
18:              shopping online    53
19:                   oil prices    50
20:               grocery stores    48
21:            local supermarket    47
22:                 stock market    45
23:                     food amp    44
24:      covid_19 coronaoutbreak    43
25:            coronavirus covid    42
26:                empty shelves    42
27:                   sick leave    41
28:                   food banks    38
29:                    food bank    37
30:                     19 https    37
31:             grocery shopping    36
32:             covid_19 covid19    36
33:          supermarket shelves    35
34:                covid19 https    35
35:                    paid sick    34
36:                    stay home    34
37:                    panic buy    34
38:                 corona virus    33
39:                 stock piling    33
40:      coronaoutbreak covid_19    32
41:                   local food    31
42:                  toilet roll    31
43:                  canned food    29
44:     coronapocalypse covid_19    28
45:               19 coronavirus    26
46:             covid19 covid_19    26
47:              covid2019 https    26
48:                    stay safe    26
49:            social distancing    25
50:         coronavirus pandemic    25
51:                retail stores    24
52:         covid_19 panicbuying    24
53:                store shelves    24
54:  coronapocalypse coronavirus    24
55:               store covid_19    23
56:                  19 outbreak    22
57:                   gas prices    22
58:               online grocery    22
59:                      2 weeks    22
60:     covid_19 coronapocalypse    22
61:              hand sanitizers    21
62:         panicbuying covid_19    21
                          bigram     n</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>bigram_graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(bigrams)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>bigram_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>IGRAPH 4ae1485 DN-- 7596 126484 -- 
+ attr: name (v/c), Location (e/c), TweetAt (e/c), Sentiment (e/c),
| bigram (e/c), word1 (e/c), word2 (e/c)
+ edges from 4ae1485 (vertex names):
 [1] 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953
 [9] 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953
[17] 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953
[25] 1-&gt;44953 1-&gt;44953 1-&gt;44953 1-&gt;44953 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954
[33] 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954
[41] 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954
[49] 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954 2-&gt;44954
+ ... omitted several edges</code></pre>
</div>
</div>
</section>
<section id="visual-connections-of-words" class="level2">
<h2 class="anchored" data-anchor-id="visual-connections-of-words">Visual connections of Words</h2>
<p>Visualising relationships among words simultaneously, rather than just the frequencies can be useful. We arrange the words into a network, or “graph.” Here “graph” means a combination of connected nodes. It has three variables:</p>
<p><code>from:</code> the node an edge is coming from</p>
<p><code>to:</code> the node an edge is going towards</p>
<p><code>weight:</code> A numeric value associated with each edge (how many times the words at the node appear together)</p>
<p>In the example below we create a custom stop word list, we then count bigrams and remove stop words in the bigrams. We then create the bigram_graph mapping needed for nodes and edges. Then we show two possible graph outputs. There are many options when creating these types of graphs. Its worth reading some of the help pages and vignettes to understand these commands.</p>
<p>We’ll split it for you into a few stages, so you can see what’s going on:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2020</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Create custom stop word list</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>final_stop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">word =</span> <span class="fu">c</span>(<span class="st">"https"</span>, <span class="st">"t.co"</span>, <span class="st">"n"</span>), </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lexicon =</span><span class="st">"custom"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(stop_words) <span class="co">#adds custom words to stop list</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Create and count bigrams</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>mydata_words_bigrams <span class="ot">&lt;-</span> mydata_TB <span class="sc">%&gt;%</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(bigram, text, </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">token =</span> <span class="st">"ngrams"</span>, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(bigram, <span class="fu">c</span>(<span class="st">"word1"</span>, <span class="st">"word2"</span>),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word1 <span class="sc">%in%</span> final_stop<span class="sc">$</span>word) <span class="sc">%&gt;%</span> <span class="co">#uses the combined preset and custom list</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word2 <span class="sc">%in%</span> final_stop<span class="sc">$</span>word)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>mydata_words_bigrams</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29,509 × 7
   doc_id ScreenName Location TweetAt    Sentiment          word1       word2   
    &lt;int&gt;      &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;              &lt;chr&gt;       &lt;chr&gt;   
 1      1      44953 UK       02/03/2020 Extremely Negative yorkers     encount…
 2      1      44953 UK       02/03/2020 Extremely Negative encounter   empty   
 3      1      44953 UK       02/03/2020 Extremely Negative empty       superma…
 4      1      44953 UK       02/03/2020 Extremely Negative supermarket shelves 
 5      1      44953 UK       02/03/2020 Extremely Negative shelves     pictured
 6      1      44953 UK       02/03/2020 Extremely Negative pictured    wegmans 
 7      1      44953 UK       02/03/2020 Extremely Negative brooklyn    sold    
 8      1      44953 UK       02/03/2020 Extremely Negative online      grocers 
 9      1      44953 UK       02/03/2020 Extremely Negative grocers     foodkick
10      1      44953 UK       02/03/2020 Extremely Negative foodkick    maxdeli…
# ℹ 29,499 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># below in the data output, scroll to the right with &gt; arrow, to see what are values for word1 and word2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>OK so now we have our bigrams, it’s time to graph them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>mydata_words_bigrams_ct <span class="ot">&lt;-</span> mydata_words_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(word1, word2, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mydata_words_bigrams_ct, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
   word1               word2                   n
   &lt;chr&gt;               &lt;chr&gt;               &lt;int&gt;
 1 covid               19                    771
 2 grocery             store                 678
 3 toilet              paper                 314
 4 online              shopping              227
 5 panic               buying                183
 6 coronavirus         covid_19               91
 7 covid_19            coronavirus            89
 8 retail              store                  74
 9 coronavirus         covid19                65
10 hand                sanitizer              63
11 coronaviruspandemic covid_19               59
12 local               grocery                59
13 covid_19            coronaviruspandemic    58
14 covid19             coronavirus            53
15 shopping            online                 53
16 oil                 prices                 50
17 grocery             stores                 48
18 local               supermarket            47
19 stock               market                 45
20 food                amp                    44</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the bigram_graph</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>bigram_graph <span class="ot">&lt;-</span> mydata_words_bigrams_ct <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">graph_from_data_frame</span>()</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the graph edges (for now just the data, picture coming soon)</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>bigram_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>IGRAPH 3dfd25c DN-- 53 56 -- 
+ attr: name (v/c), n (e/n)
+ edges from 3dfd25c (vertex names):
 [1] covid              -&gt;19                 
 [2] grocery            -&gt;store              
 [3] toilet             -&gt;paper              
 [4] online             -&gt;shopping           
 [5] panic              -&gt;buying             
 [6] coronavirus        -&gt;covid_19           
 [7] covid_19           -&gt;coronavirus        
 [8] retail             -&gt;store              
+ ... omitted several edges</code></pre>
</div>
</div>
</section>
<section id="finally-cherry-on-the-cake-the-visual-graph-depicting-word-colocations." class="level2">
<h2 class="anchored" data-anchor-id="finally-cherry-on-the-cake-the-visual-graph-depicting-word-colocations.">Finally… cherry on the cake: the visual graph depicting word colocations.</h2>
<p><strong>Notice the direction of arrows!</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#First graph option</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(bigram_graph, <span class="at">layout =</span> <span class="st">"fr"</span>) <span class="sc">+</span> <span class="co">#use the fr layout algorithm</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>() <span class="sc">+</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>() <span class="sc">+</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="co">#use repel so the words do not overlap</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="co">#void theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/ggraph1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#the above row determines the lay the arrows will look</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">#check out ?arrow for more information</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>arrows_info <span class="ot">&lt;-</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">length =</span> <span class="fu">unit</span>(.<span class="dv">2</span>, <span class="st">"cm"</span>))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Second Graph option</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(bigram_graph, <span class="at">layout =</span> <span class="st">"fr"</span>) <span class="sc">+</span> <span class="co">#use the fr layout</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">edge_alpha =</span> n), <span class="co">#vary the edge color by n</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#darker lines are bigrams that occur more often</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">arrow =</span> arrows_info, <span class="co">#add the arrow information</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">size =</span> <span class="dv">2</span>,<span class="at">color =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span> <span class="co">#makes the geom slightly larger</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="co">#adds text labels for the nodes</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="co">#void theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="nlp_badge_05_FreqVisualSummary_v1.3_files/figure-html/ggraph1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note for the curious: do you see that following those arrows can be used for basic “auto prediction of text”? You could start assembling longer and longer common phrases by following arrows directions e.g.&nbsp;:“local -&gt; grocery -&gt; store -&gt; shelves” or “covid -&gt; 19 -&gt; outbreak”</p>
</section>
<section id="summary-of-characteristics-of-your-data" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-characteristics-of-your-data">Summary of Characteristics of Your Data</h2>
<p>Below we give an example of how to find some of the summary properties of our data that we discussed in the video.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>text_data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"The sleek cat jumps over the lazy dog."</span>,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"R is a great great great language."</span>, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Natural Language Processing is a complex field. Oh yeah!"</span>) </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Tokenize the text</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>tokenized_text <span class="ot">&lt;-</span> <span class="fu">unnest_tokens</span>(<span class="at">tbl =</span> <span class="fu">data.frame</span>(<span class="at">text =</span> text_data), <span class="at">output =</span> word, <span class="at">input =</span> text) </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Document lengths (in this case our sentence).  Here we are using the space between words to create document lengths.  You could use unnest again and count the total number of words per document.</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>doc_lengths <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(text_data, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>), length)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(doc_lengths) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8 7 9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># words:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and then:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#number of characters in our documents</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>char_lengths <span class="ot">&lt;-</span> <span class="fu">sapply</span>(text_data, nchar) </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(char_lengths) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  The sleek cat jumps over the lazy dog. 
                                                      38 
                      R is a great great great language. 
                                                      34 
Natural Language Processing is a complex field. Oh yeah! 
                                                      56 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># characters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and then:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Here we are calculating lexical diversity again just using space between words to understand the documents words.</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>lexical_diversity <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(text_data, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>), <span class="cf">function</span>(words) { <span class="fu">length</span>(<span class="fu">unique</span>(words)) <span class="sc">/</span> <span class="fu">length</span>(words) }) </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lexical_diversity) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.0000000 0.7142857 1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lexical complexity (why is the middle sentence less fomplex?)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and then:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out stopwords </span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>non_stop_words <span class="ot">&lt;-</span> tokenized_text <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(word)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the total number of stopwords </span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>total_stopwords <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tokenized_text) <span class="sc">-</span> <span class="fu">nrow</span>(non_stop_words) </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>percentage_stopwords <span class="ot">&lt;-</span> total_stopwords <span class="sc">/</span> <span class="fu">nrow</span>(tokenized_text) <span class="sc">*</span> <span class="dv">100</span> </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(percentage_stopwords) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># precentage stopwords: (in the whole set)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and then:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split text into sentences and count the number of words in each sentence </span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>sentence_counts <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(text_data, <span class="st">"[!?</span><span class="sc">\\</span><span class="st">.]+"</span>) <span class="sc">%&gt;%</span> <span class="fu">lengths</span>() </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sentence_counts) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 2</code></pre>
</div>
</div>
</section>
</section>
<section id="reflection" class="level1">
<h1>Reflection:</h1>
<p>Now is a good moment to write down your self reflection: think of 3 STARS (things that you learned in this badge), and 1 WISH: a thing you wish you understood better. You might also thing of what would you do to fulfil your wish. Write them down.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion:</h1>
<p>You’ve now see a number of practical ways of visualising your text data. Notice how most of the time the process involves identifying ‘messy’ parts of the dataset, and cleaning them up before the visualisation makes sense. Visualisations are often just a way to get some insight before you continue with further analysis.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>